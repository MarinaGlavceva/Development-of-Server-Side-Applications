# Отчёт по лабораторной работе №1 — **TodoApp** (Express.js, MVC, Pug)

## 1) Инструкции по запуску проекта

### Требования
- Node.js (рекомендуется LTS, например 18+)
- Любая ОС (Windows / macOS / Linux)

### Шаги
```bash
# в папке проекта
npm install          # установить зависимости
# переменные окружения в .env уже настроены:
# APP_NAME=TodoApp
# PORT=3000
# NODE_ENV=development

# запуск приложения
node app.js
# (опционально для разработки)
# npm run dev  # если добавлен скрипт с nodemon
```

После старта сервер слушает по адресу: **http://localhost:3000**

### Быстрая проверка
- Перейти на `/` — список задач.
- `/new` — создать задачу → редирект на `/`, задача отображается.
- Нажать «○/✓» — переключение статуса.
- Нажать «Удалить» — удаление задачи.
- `/about` — статическая страница.
- Любой «левый» путь — страница `404`.

> Примечание: данные храню в оперативной памяти процесса, поэтому **после перезапуска** список задач очищается — это ожидаемо для лабы без БД.

---

## 2) Описание лабораторной работы

**Цель:** понять базовую связку **Express + MVC**: контроллеры, роуты, представления; на практике отработать обработку HTML-форм и PRG-редиректы; реализовать минимальное приложение без БД с хранилищем в памяти.

**Что реализовала:**
- Просмотр списка задач (`GET /`).
- Создание задач (`GET /new` + `POST /new`), серверная валидация.
- Переключение статуса (`POST /:id/toggle`).
- Удаление задачи (`POST /:id/delete`).
- Статическая страница «О нас» (`GET /about`).
- Обработка 404 (шаблон `404.pug`).

**Доп. задание (выполнено опционально):**
- Фильтрация на `/` с селектом: **all / active / completed** → `GET /?status=...`.
- Все действия (create/toggle/delete) сохраняют текущий фильтр при редиректе.

---

## 3) Краткая документация к проекту

### Архитектура и структура
```
todo-app/
├─ app.js                  # Точка входа: Express, middleware, подключение роутов и 404
└─ src/
   ├─ controllers/
   │  ├─ aboutController.js
   │  ├─ errorController.js
   │  └─ todoController.js
   ├─ models/
   │  └─ todo.js           # In-memory модель задач
   ├─ routes/
   │  ├─ staticRoutes.js   # /about
   │  └─ todoRoutes.js     # /, /new, /:id/toggle, /:id/delete
   ├─ public/
   │  └─ styles.css        # Лёгкий светлый дизайн
   └─ views/
      ├─ 404.pug
      ├─ about.pug
      ├─ index.pug
      ├─ layout.pug
      └─ new.pug
```

### Маршруты (HTML)
| Метод | Путь             | Назначение                                          |
|------:|------------------|------------------------------------------------------|
| GET   | `/`              | Список задач (опц. фильтр `?status=all|active|completed`) |
| GET   | `/new`           | Форма создания задачи                                |
| POST  | `/new`           | Создание задачи + **redirect** на `/` (PRG)          |
| POST  | `/:id/toggle`    | Переключение статуса задачи                          |
| POST  | `/:id/delete`    | Удаление задачи                                      |
| GET   | `/about`         | Статическая страница «О нас»                         |
| —     | `*`              | 404: рендер отдельного шаблона                       |

### Модель `src/models/todo.js`
- Структура элемента: `{ id, title, completed, createdAt }`.
- Методы:
  - `all()` — вернуть массив задач.
  - `create(title)` — добавить новую задачу.
  - `toggle(id)` — переключить `completed`.
  - `remove(id)` — удалить по `id`.

> Идентификатор формирую через `crypto.randomUUID()` (или резервный способ, если среда без `randomUUID`).

### Контроллеры
- `todoController`:
  - `index` — читает данные, применяет фильтр, рендерит `index.pug`.
  - `newForm` — рендер `new.pug`.
  - `create` — валидация `title`, создание, redirect на список (с сохранением фильтра).
  - `toggle` — переключение по `id`, redirect назад.
  - `delete` — удаление по `id`, redirect назад.
- `aboutController` — рендер `about.pug`.
- `errorController` — рендер `404.pug` с кодом 404 и `req.originalUrl`.

### Представления (Pug)
- `layout.pug` — общий каркас, подключение `/styles.css`, навигация, футер.
- `index.pug` — список задач, селект-фильтр, кнопки действий.
- `new.pug` — форма создания с обработкой ошибки.
- `about.pug` — статический текст.
- `404.pug` — страница ошибки.

### Стили
В `src/public/styles.css` — минималистичный светлый UI: карточки, кнопки, селект, состояние «выполнена» (зачёркивание).

---

## 4) Примеры использования (код/скриншоты)

### Через браузер
- `http://localhost:3000/` — список задач.
- `http://localhost:3000/new` — форма создания.

### Через `curl` (POST-формы)
```bash
# создать задачу
curl -X POST -d "title=Купить молоко" http://localhost:3000/new

# переключить статус (подставить реальный id)
curl -X POST http://localhost:3000/<taskId>/toggle

# удалить
curl -X POST http://localhost:3000/<taskId>/delete
```

### Снимки экрана (из процесса разработки)
> Скриншоты приложены как ссылки (могут открыться во вьювере среды):
- Форма создания задачи (`/new`):  
  <img width="937" height="371" alt="Image" src="https://github.com/user-attachments/assets/abe2036c-5c47-4f24-97fa-28076b52232e" />
- Переход по «Главная» с заглушки на раннем этапе:  
<img width="920" height="426" alt="Image" src="https://github.com/user-attachments/assets/846aa031-3cea-4553-a9d3-67d2f8128b46" />
- Ошибка из Windows CMD при создании папок (диагностика на старте):  
  ![cmd](sandbox:/mnt/data/98161f3f-5a34-4fd8-8ef5-38c8659ff43c.png)

---

## 5) Ответы на контрольные вопросы

**1) Чем отличаются HTML-маршруты от REST API?**  
HTML-маршруты возвращают **готовый HTML** (SSR) и обычные формы/редиректы; UI отрисовывается сервером. REST API возвращает **данные** (обычно JSON), отделяя фронтенд от бекенда; акцент на ресурсах и семантике методов HTTP (`GET/POST/PUT/PATCH/DELETE`), идемпотентности, статус-кодах. В этой лабе я использую **HTML-маршруты**.

**2) Что такое `res.render` и `res.json`? В каких случаях что использовать?**  
`res.render(view, data)` — рендерит шаблон (Pug/EJS) в HTML и отправляет браузеру; использую для страниц.  
`res.json(obj)` — отправляет JSON (API-ответ); применимо в REST/SPA, AJAX-запросах, для машинных клиентов.  
В этом проекте основной способ — **`res.render`**.

**3) Что такое middleware в Express и для чего используется `express.urlencoded`?**  
Middleware — «прослойки», через которые проходят `req`/`res` (логирование, парсинг тела, статика, авторизация, обработка ошибок и т.д.).  
`express.urlencoded({ extended: false })` парсит тело запросов с типом `application/x-www-form-urlencoded` (стандартные HTML-формы) и заполняет `req.body`, благодаря чему я читаю поля формы на сервере.

---

## 6) Список использованных источников
- Документация **Express** — https://expressjs.com/  
- Документация **Pug** — https://pugjs.org/  
- Node.js API (модуль `crypto`) — https://nodejs.org/api/crypto.html

---

## 7) Дополнительные важные аспекты
- **PRG (Post/Redirect/Get)**: после успешной обработки формы всегда делаю redirect → защита от повторной отправки при обновлении страницы.
- **Ограничения**: in-memory-хранилище, нет аутентификации/авторизации, минимальная валидация.
- **Безопасность** (в учебных целях опущена): для прод-уровня нужны CSRF-защита, шифрование cookie/сессии, хардненинг заголовков и пр.
- **Удобство разработки**: можно добавить `nodemon`-скрипт (`npm run dev`) и логгер (`morgan`), но это не обязательно.
